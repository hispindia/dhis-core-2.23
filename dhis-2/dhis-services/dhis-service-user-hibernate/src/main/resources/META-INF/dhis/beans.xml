<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="
http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd">
  
  <bean id="org.hisp.dhis.user.UserStore" 
    class="org.hisp.dhis.user.hibernate.HibernateUserStore">
    <property name="sessionFactory" ref="sessionFactory"/>
  </bean>
    
  <bean id="org.hisp.dhis.user.CurrentUserService"
    class="org.hisp.dhis.user.DefaultCurrentUserService">
    <property name="userStore" ref="org.hisp.dhis.user.UserStore"/>
  </bean>
  
  <bean id="org.hisp.dhis.user.UserSettingService"
    class="org.hisp.dhis.user.DefaultUserSettingService">
    <property name="currentUserService" ref="org.hisp.dhis.user.CurrentUserService"/>
    <property name="userStore" ref="org.hisp.dhis.user.UserStore"/>
  </bean>
  
  <bean id="org.hisp.dhis.user.UserService"
    class="org.hisp.dhis.user.DefaultUserService">
    <property name="userStore" ref="org.hisp.dhis.user.UserStore"/>
  </bean>
  
  <!-- DeletionHandlers -->
  
  <bean id="org.hisp.dhis.user.UserDeletionHandler"
    class="org.hisp.dhis.user.UserDeletionHandler">
    <property name="userStore"
      ref="org.hisp.dhis.user.UserStore"/>
  </bean>
  
  <bean id="org.hisp.dhis.user.UserAuthorityGroupDeletionHandler"
    class="org.hisp.dhis.user.UserAuthorityGroupDeletionHandler">
    <property name="userStore"
      ref="org.hisp.dhis.user.UserStore"/>
  </bean>
  
  <bean id="org.hisp.dhis.user.UserCredentialsDeletionHandler"
    class="org.hisp.dhis.user.UserCredentialsDeletionHandler">
    <property name="userStore"
      ref="org.hisp.dhis.user.UserStore"/>
  </bean>
  
  <bean id="org.hisp.dhis.user.UserSettingDeletionHandler"
    class="org.hisp.dhis.user.UserSettingDeletionHandler">
    <property name="userSettingService"
      ref="org.hisp.dhis.user.UserSettingService"/>
  </bean>
  
  <!-- DeletionManager -->
  
  <bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
    <property name="targetObject" ref="org.hisp.dhis.system.deletion.DeletionManager"/>
    <property name="targetMethod" value="addDeletionHandlers"/>
    <property name="arguments">
      <list>
        <list>
          <ref local="org.hisp.dhis.user.UserDeletionHandler"/>
          <ref local="org.hisp.dhis.user.UserAuthorityGroupDeletionHandler"/>
          <ref local="org.hisp.dhis.user.UserCredentialsDeletionHandler"/>
          <ref local="org.hisp.dhis.user.UserSettingDeletionHandler"/>
        </list>
      </list>
    </property>
  </bean>
  
  <!-- Deletion AOP definitions -->
  
  <aop:config>
  
    <aop:aspect ref="deletionInterceptor">      
      <aop:before pointcut="execution( * org.hisp.dhis.user.UserStore.delete*(..) )" method="intercept"/>
    </aop:aspect>
      
  </aop:config>
  
</beans>
