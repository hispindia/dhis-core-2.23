<script src="../dhis-web-commons/ouwt/ouwt.js"></script>
<script src="scripts/tracker-capture.js"></script>

<div id="leftBar">
    <br/>
    <br/>
    <div id="orgUnitTree">
        <ul>
        </ul>
    </div>
    <img id="ouwt_loader" src="../images/ajax-loader-bar.gif"/>
</div>
<div class="page" id="mainPage">
    <h1>
        <span ng-show="!selectedProgram">
            {{'search'| translate}} {{selectedProgram.trackedEntity.name}}
        </span>
        <span ng-show="selectedProgram">
            {{'search_for'| translate}} {{selectedProgram.trackedEntity.name}}
        </span>            
        <a href ng-click="getHelpContent()" title="{{'help'| translate}}"><i class="fa fa-question-circle"></i></a>
    </h1>

    <!-- selection begins-->
    <div>
        <table>
            <tr>
                <td><label>{{'registering_unit'| translate}}</label></td>
                <td><input type="text" selected-org-unit ng-model="selectedOrgUnit.name" value="{{selectedOrgUnit.name|| 'please_select'| translate}}" disabled=""></td>                           
            </tr>
            <tr>
                <td><label>{{'program'| translate}}<em title="{{'required'| translate}}" class="required">*</em></label></td>
                <td>
                    <select id="programId" 
                            name="programId" 
                            ng-model="selectedProgram" 
                            ng-options="program as program.name for program in programs | orderBy: 'name'" 
                            ng-change="clearEntities()"
                            ng-disabled="!selectedOrgUnit">
                        <option value="">{{'view_all'| translate}}</option>
                    </select>      
                </td>
                <td style='padding-left: 5px;'>
                    <button class="button"
                            ng-show="selectedOrgUnit" 
                            ng-click="loadTrackedEntities()">
                        {{'list_all_entities'| translate}}
                    </button>  
                </td>                
                <td style='padding-left: 5px;'>
                    <button class="button"
                            ng-disabled="!selectedOrgUnit" 
                            ng-click="showRegisteration()">
                        {{'add_new'| translate}}
                    </button>                                
                </td>
            </tr>                       
        </table>                    
    </div>                
    <!-- selection ends -->   

    <!-- search begins -->
    <div style="width: 30%;">
        <accordion>
            <accordion>
                <accordion-group is-open="{{searchField.isOpen}}">
                    <accordion-heading>
                        {{searchField.title| translate}}
                    </accordion-heading>
                    <div>
                        <div class="list-element" ng-repeat="attribute in attributes">
                            {{attribute.name}}
                            <div class="right">
                                <div ng-switch="attribute.valueType">
                                    <div ng-switch-when="date">
                                        <input type="text" ng-date ng-model="attribute.value" />
                                    </div>
                                    <div ng-switch-when="trueOnly">
                                        <input type="checkbox" ng-model="attribute.value" />
                                    </div>
                                    <div ng-switch-when="bool">
                                        <select ng-model="attribute.value" />
                                        <option value="">{{'please_select'| translate}}</option>                        
                                        <option value="0">{{'no'| translate}}</option>
                                        <option value="1">{{'yes'| translate}}</option>
                                        </select>
                                    </div>
                                    <div ng-switch-when="combo">
                                        <input type="text" 
                                               ng-model="attribute.value"                                                 
                                               typeahead="option.name for option in attribute.personAttributeOptions | filter:$viewValue | limitTo:20" 
                                               typeahead-open-on-focus 
                                               />
                                    </div>
                                    <div ng-switch-when="number">
                                        <input type="number" ng-model="attribute.value"/>
                                    </div>
                                    <div ng-switch-default>
                                        <input type="text" ng-model="attribute.value" />                                        
                                    </div>
                                </div>                                                                                                    
                            </div>
                        </div>
                        
                        <div class="vertial-spacing">
                            <button ng-click="search()">{{'search'| translate}}</button>
                        </div>
                    </div>                        
                </accordion-group>
            </accordion>                
        </accordion>                	
    </div>
    <!-- search ends -->

    <!-- entity grid begins -->
    <div id="listDiv" ng-switch="trackedEntityList">                    
        <div ng-switch-when=""></div>
        <div ng-switch-default>
            <h2>
                {{selectedProgram.trackedEntity.name || 'entity' | translate}} {{'list'| translate}}
            </h2>
            <div ng-switch="trackedEntityList.length">
                <div ng-switch-when="undefined">
                    <p>
                        {{'empty'| translate}} {{selectedProgram.trackedEntity.name || 'entity' | translate}} {{'list'| translate}}                        
                    </p>
                </div>
                <div ng-switch-when="0">
                    <p>
                        {{'empty'| translate}} {{selectedProgram.trackedEntity.name || 'entity' | translate}} {{'list'| translate}}
                    </p>
                </div>
                <div ng-switch-default>

                    <!-- entity begins -->
                    <table class="listTable dhis2-table-striped-border dhis2-table-hover">                    
                        <thead>                        
                            <tr>
                                <th ng-show="!gridColumn.hide" 
                                    class="max-column-width"                                                
                                    ng-repeat="gridColumn in gridColumns">

                                    <!-- sort icon begins -->
                                    <span ng-hide="gridColumn.showFilter" class="bold" ng-click="sortGrid(gridColumn)">
                                        <i ng-show="sortHeader == gridColumn.id && !reverse" class="fa fa-sort-desc"></i>
                                        <i ng-show="sortHeader == gridColumn.id && reverse" class="fa fa-sort-asc"></i>
                                        {{gridColumn.name}}
                                    </span>
                                    <!-- sort icon ends -->

                                    <!-- filter icon begins -->
                                    <span class='pull-right'>
                                        <span ng-show="gridColumn.type !== 'date'">
                                            <a href ng-click="filterInGrid(gridColumn)" title="{{'filter'| translate}}"><span ng-class="{true: 'filter-without-content', false: 'filter-with-content'} [filterText[gridColumn.id] == undefined || filterText[gridColumn.id] == '']"><i class="fa fa-filter"></i></span></a>
                                        </span>
                                        <span ng-show="gridColumn.type === 'date'">
                                            <a href ng-click="filterInGrid(gridColumn)" title="{{'filter'| translate}}"><span ng-class="{true: 'filter-without-content', false: 'filter-with-content'} [(filterText[gridColumn.id].start == 'undefined' || filterText[gridColumn.id].start == '') && (filterText[gridColumn.id].end == 'undefined' || filterText[gridColumn.id].end == '')]"><i class="fa fa-filter"></i></span></a>
                                        </span>                                                    
                                    </span>
                                    <!-- filter icon ends -->

                                    <!-- filter input field begins -->
                        <div ng-show="gridColumn.showFilter">
                            <span ng-show="gridColumn.type !== 'date'">
                                <input type="text" ng-model="filterText[gridColumn.id]" ng-blur="filterInGrid(gridColumn)">
                            </span>                                                    
                            <span ng-show="gridColumn.type === 'date'">
                                <input placeholder="{{'start_date'| translate}}" type="text" ng-model="filterText[gridColumn.id].start" data-ng-date readonly="readonly">
                                <span ng-hide="filterText[gridColumn.id].start == 'undefined' || filterText[gridColumn.id].start == ''">
                                    <a href ng-click='removeStartFilterText(gridColumn.id)'><span class='black'><i class="fa fa-trash-o"></i></span></a>                                                        
                                </span>
                                <input placeholder="{{'end_date'| translate}}" type="text" ng-model="filterText[gridColumn.id].end" data-ng-date readonly="readonly">
                                <span ng-hide="filterText[gridColumn.id].end == 'undefined' || filterText[gridColumn.id].end == ''">
                                    <a href ng-click='removeEndFilterText(gridColumn.id)'><span class='black'><i class="fa fa-trash-o"></i></span></a>                                                        
                                </span>
                            </span>
                        </div>
                        <!-- filter input field ends -->
                        </th>                                    
                        </tr>                        
                        </thead>
                        <tbody id="list">
                            <tr ng-repeat="trackedEntity in trackedEntityList| paginate:rowsPerPage | orderBy:sortHeader:reverse | gridFilter:filterText:currentFilter" 
                                ng-click="showDashboard(trackedEntity)">

                                <td class="max-column-width"                                              
                                    ng-repeat="gridColumn in gridColumns">                                                
                                    {{trackedEntity[gridColumn.id]}}                                                
                                </td>

                            </tr>
                        </tbody>        
                    </table>
                    <paginator></paginator>
                    <!-- entity ends -->                            
                </div>
            </div>                        
        </div>

    </div> 
    <!-- entity grid ends -->
</div>           


