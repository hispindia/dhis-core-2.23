<script type="text/javascript" src="../dhis-web-commons/oust/oust.js"></script>

## You don't have to use this template directly if you don't want to
<table cellspacing=0 width="795px">
	<thead>
		<tr>
			<th colspan="2">$i18n.getString( "organisation_unit_selection_tree" )			
				<select id="treeSelectedId" name="treeSelectedId" #if( $required ) class="{validate:{required:true}}" #end multiple="multiple" style="display:none"/>			
			</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>
				<div style="height:360px;width:100%;background-image:url( ../images/loading.png );background-repeat:no-repeat">	
					<div id="selectionTreeContainer" style="display:none;">
						<input type="button" value="$i18n.getString( 'select_at_level' )" onclick="selectOrganisationUnitAtLevel()" style="width:12em"/>
						<select id="levelList" name="levelList" style="width:12em"/>
						<input type="button" value="$i18n.getString( 'unselect_at_level' )" onclick="unSelectOrganisationUnitAtLevel()" style="width:12em"/>
						<input type="button" value="$i18n.getString( 'unselect_all' )" onclick="unSelectAllTree()" style="width:12em"/>	
						<input type="button" value="$i18n.getString( 'unselect_children' )" onclick="unSelectChildren()" style="width:12em"/>	
						<br>
						<input type="button" value="$i18n.getString( 'select_in_group' )" onclick="selectOrganisationUnitByGroup()" style="width:12em">
						<select id="groupList" name="groupList" style="width:12em"/>
						<input type="button" value="$i18n.getString( 'unselect_in_group' )" onclick="unSelectOrganisationUnitByGroup()" style="width:12em">	
						<input type="button" value="$i18n.getString( 'select_all' )" onclick="selectAllTree()" style="width:12em"/>	
						<input type="button" value="$i18n.getString( 'select_children' )" onclick="selectChildren()" style="width:12em"/>	
						<div id="selectionTree" style="padding:5px;width:100%"></div>
					</div>
				</div>
			</td>
		</tr>
	</tbody>
</table>	

<script type="text/javascript">

	var selectedOrganisationUnitListABCDEF;
	
	function addSelectedOrganisationUnitABCDEF( id )
	{
		selectedOrganisationUnitListABCDEF.append( '<option value="' + id + ' selected="selected">' + id + '</option>');
	}

	function selectOrganisationUnitABCDEF( ids )
	{
		selectedOrganisationUnitListABCDEF.empty();
		
		jQuery.each( ids, function(i, item ){
			selectedOrganisationUnitListABCDEF.append( '<option value="' + item + ' selected="selected">' + item + '</option>');
		});
		byId('treeSelectedId').selectedIndex = 0;
	}
	
	function selectedOrganisationUnitXMLABCDEF( xml )
	{		
		#if( $required )
			selectedOrganisationUnitListABCDEF.empty();
			
			jQuery.each( jQuery( xml ).find( 'unitId'), function(i, item){
				id = item.firstChild.nodeValue;
				selectedOrganisationUnitListABCDEF.append( '<option value="' + id + ' selected="selected">' + id + '</option>');
			});
		#end
		selectionTree.buildSelectionTree();
	}	
	
	function unSelectChildren()
	{
		jQuery.get( '../dhis-web-commons/oust/removeorgunit.action',
			{children: true},
			function( xml ){
				selectedOrganisationUnitXMLABCDEF( xml );
			});
	}
	
	function selectChildren()
	{
		jQuery.get( '../dhis-web-commons/oust/addorgunit.action',
			{children: true},
			function( xml ){
				selectedOrganisationUnitXMLABCDEF( xml );
			});
	}
	
	function selectOrganisationUnitAtLevel()
	{
		jQuery.get( '../dhis-web-commons/oust/addorgunit.action',
			{level: getFieldValue( 'levelList' )},
			function( xml ){
				selectedOrganisationUnitXMLABCDEF( xml );
			});
	}
	
	function unSelectOrganisationUnitAtLevel()
	{
		jQuery.get( '../dhis-web-commons/oust/removeorgunit.action',
			{level: getFieldValue( 'levelList' )},
			function( xml ){
				selectedOrganisationUnitXMLABCDEF( xml );
			});
	}
	
	function unSelectAllTree()
	{
		jQuery.get( '../dhis-web-commons/oust/clearSelectedOrganisationUnits.action',			
			function( xml ){
				selectedOrganisationUnitXMLABCDEF( xml );
			});
	}
	
	function selectAllTree()
	{
		jQuery.get( '../dhis-web-commons/oust/selectallorgunit.action',			
			function( xml ){
				selectedOrganisationUnitXMLABCDEF( xml );
			});
	}
	
	function selectOrganisationUnitByGroup()
	{
		jQuery.get( '../dhis-web-commons/oust/addorgunit.action',
			{organisationUnitGroupId: getFieldValue( 'groupList' )},
			function( xml ){
				selectedOrganisationUnitXMLABCDEF( xml );
			});
	}
	
	function unSelectOrganisationUnitByGroup()
	{
		jQuery.get( '../dhis-web-commons/oust/removeorgunit.action',
			{organisationUnitGroupId: getFieldValue( 'groupList' )},
			function( xml ){
				selectedOrganisationUnitXMLABCDEF( xml );
			});
	}
	
	
	
	function loadOrganisationUnitLevel()
	{		
		jQuery.getJSON('../dhis-web-commons-ajax-json/getOrganisationUnitLevels.action',
		function( json ){
			var levels = jQuery("#levelList");
			levels.empty();
			jQuery.each( json.levels, function(i, item){
				levels.append( '<option value="' + item.level + '">' + item.name + '</option>');
			});			
			jQuery( "#selectionTreeContainer" ).fadeIn();
		});
	}
	
	function loadOrganisationUnitGroup()
	{
		jQuery.getJSON('../dhis-web-commons-ajax-json/getOrganisationUnitGroups.action',
		function( json ){
			var groups = jQuery("#groupList");
			groups.empty();
			jQuery.each( json.organisationUnitGroups, function(i, item){
				groups.append( '<option value="' + item.id + '">' + item.name + '</option>');
			});	

			loadOrganisationUnitLevel();	
		});
	}
	
	
	jQuery(document).ready( function(){		
		loadOrganisationUnitGroup();
		selectionTreeSelection.setMultipleSelectionAllowed( true );
		selectedOrganisationUnitListABCDEF = jQuery( "#treeSelectedId" );
		#if( $required )			
			selectionTreeSelection.setListenerFunction( selectOrganisationUnitABCDEF );
		#end	
		#if( $cleanAll )						
			selectionTree.clearSelectedOrganisationUnits();			
		#end	
		selectionTree.buildSelectionTree();	
	});
	
</script>
